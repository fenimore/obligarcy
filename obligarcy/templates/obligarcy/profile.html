{% extends "obligarcy/base.html" %}

{% block content %}

{% if user.is_authenticated %}
<div class='row'>
  <div class=col-md-4>
    <div class="media">
      <div class="media-left">
        <a href="/profile/">
          {% if profile.userprofile.picture %}

          <img class="media-object"
               src="{{ profile.userprofile.picture.path }}" alt="Problem serving picture"/>
          {% endif %}
        </a>
      </div>
      <div class="media-body">
        <h4 class="media-heading">{{ profile.username }}</h4>
        {{ profile.userprofile.bio}}<br>
        Joined {{ user.date_joined.strftime('%D') }}<br>
      </div>
    </div>
  </div>
  <div class=col-md-4>
    <span class="glyphicon glyphicon-map-marker" aria-hidden="true"></span> {{ user.userprofile.location }}<br><br>
    <span class="glyphicon glyphicon-apple" aria-hidden="true"></span> {{ user.has_completed.all()|length }}<br>
    <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> {{ user.deadline_set.filter(is_accomplished=True, is_late=False)|length }}<br>
    <span class="glyphicon glyphicon-inbox" aria-hidden="true"></span> {{ user.deadline_set.filter(is_expired=False, is_accomplished=False)|length }}<br>


    <hr>
    {% if can_follow %}
      {% if already_follows %}
      <a class='btn btn-default' href=/unfollow/{{ request.session.id }}/{{profile.id}}>Unsubscribe</a>
      {% else %}
      <a class='btn btn-info' href=/follow/{{ request.session.id }}/{{profile.id}}>Follow</a>
      {% endif %}
    {% endif %}
  </div>
</div>
<hr>
<div class='row'>
  <div class='col-md-4'>

    <h3>Completed Contracts</h3>
    {% if completed %}
      <table class="table  table-hover">
        <tr><th>Completed Contracts</th></tr>
        {% for contract in completed %}
            <tr>
              <td><a href="/contract/{{ contract.id }}/">{{ contract.title[:30] + '..' }}<br>
              @ {{ contract.end_date.date().strftime('%D - %A')}}</td>
            </tr>
        {% endfor %}
      </table>
    {% else %}
        <p>This User has no Completed Contracts</p>
    {% endif %}
  </div>
  <div class='col-md-4'>
    {% if follows %}
    <table class="table table-hover">
      <tr><th>Follows</th></tr>
        {% for f in follows %}
          <tr>
            <td><a href="/user/{{ f.user.id }}/">{{ f.user.username }}</a></td>
          </tr>
         {% endfor %}
    </table>
    {% else %}
        <p>No one is following {{ profile.username }}</p>
    {% endif %}
  </div>
  <div class='col-md-4'>
    {% if followed_by %}
    <table class="table table-striped table-hover">
      <tr><th>Followed By</th></tr>
        {% for f in followed_by %}
          <tr>
            <td><a href="/user/{{ f.user.id }}/">{{ f.user.username }}</a></td>
          </tr>
         {% endfor %}
    </table>
    {% else %}
        <p>No one is following {{ profile.username }}</p>
    {% endif %}
  </div>
</div>
<div class='row'>
  <div class='col-md-4'>
    {% if posts %}
    <table class="table table-hover">
      <tr><th>Submissions</th></tr>
        {% for post in posts %}
          <tr>
            <td>
              <a href="/submission/{{ post.id }}/">{{ post.body[:30] + '..' }}</a><br>
              @ {{ post.pub_date.date().strftime('%D - %A')}} <br>
              For deadline: {{ post.deadline_set.all().first()}}
            </td>
          </tr>
         {% endfor %}
    </table>
    {% else %}
        <p>No Submissions</p>
    {% endif %}
  </div>
  <div class='col-md-4'>
    {% if contracts %}
    <table class="table table-hover">
      <tr><th>Contracts</th></tr>
        {% for contract in contracts %}
          <tr>
            <td>
              <a href="/contract/{{ contract.id }}/">{{ contract.title[:15] }}...</a>
            </td>
            <td>
              {{contract.end_date.strftime('%D')}}
            </td>
          </tr>
         {% endfor %}
    </table>
    {% else %}
        <p>No Submissions</p>
    {% endif %}
    <h3>Contracts</h3>
    {% if contracts %}
        <ul>
        {% for contract in contracts %}
            <li><a href="/contract/{{ contract.id }}/">{{ contract.title }}</a></li>
            Deadline: {{ contract.end_date.strftime('%D')}}
            <hr>
        {% endfor %}
        </ul>
    {% else %}
        <p>This User has no (active) contracts</p>
    {% endif %}
  </div>
  <div class='col-md-4'>
    <h3>Up Coming Deadlines</h3>
    {% if deadlines %}
        <ul>
        {% for deadline in deadlines %}
        Deadline: {{ deadline.deadline.strftime('%D') }}
            <li>Contract: <a href="/contract/{{ deadline.contract.id }}/">{{ deadline.contract.title[:30] }}...</a></li>

            <hr>
        {% endfor %}
        </ul>
    {% else %}
        <p>This User has no (active) contracts</p>
    {% endif %}

    {% else %}
        <p>You are Not Authenticated!</p>
    {% endif %}
  </div>
</div>



{% endblock content %}
